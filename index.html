<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ÊöóÁÆó„Éà„É¨„Éº„Éã„É≥„Ç∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0f0f13;
      --surface: #1a1a24;
      --border: #2e2e42;
      --accent: #7c5cfc;
      --accent2: #00e5a0;
      --text: #f0f0f5;
      --muted: #8888aa;
      --correct: #00e5a0;
      --wrong: #ff5277;
    }

    html, body {
      height: 100%;
      -webkit-text-size-adjust: 100%;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Noto Sans JP', sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 16px 16px 32px;
      overflow-x: hidden;
    }

    .screen { display: none; width: 100%; max-width: 500px; }
    .screen.active { display: flex; flex-direction: column; align-items: center; }

    /* ===== START SCREEN ===== */
    .top-space { height: 24px; }

    .title-badge {
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      color: white;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 3px;
      padding: 5px 14px;
      border-radius: 20px;
      margin-bottom: 16px;
      text-transform: uppercase;
    }

    h1 {
      font-size: clamp(1.8rem, 7vw, 2.8rem);
      font-weight: 900;
      text-align: center;
      line-height: 1.15;
      margin-bottom: 6px;
    }

    h1 span {
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle { color: var(--muted); font-size: 13px; margin-bottom: 28px; }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      width: 100%;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 14px;
    }

    /* ===== Ê°ÅÊï∞„Çª„É¨„ÇØ„Çø„Éº ===== */
    .digits-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .digits-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 120px;
    }

    .digits-label {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 1px;
    }

    .digits-btns {
      display: flex;
      gap: 6px;
    }

    .digit-btn {
      width: 44px;
      height: 44px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 13px;
      font-weight: 700;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .digit-btn:hover  { border-color: var(--accent); color: var(--accent); }
    .digit-btn.selected { border-color: var(--accent); background: rgba(124,92,252,0.18); color: var(--accent); }

    .digits-op {
      font-family: 'DM Mono', monospace;
      font-size: 28px;
      color: var(--accent);
      padding: 0 4px;
      padding-top: 20px;
    }

    .preview-expr {
      text-align: center;
      font-family: 'DM Mono', monospace;
      font-size: 13px;
      color: var(--muted);
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .preview-expr span { color: var(--accent2); }

    /* ÂïèÈ°åÊï∞ */
    .count-grid { display: flex; gap: 8px; }

    .count-btn {
      flex: 1;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 8px;
      color: var(--text);
      cursor: pointer;
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 15px;
      font-weight: 700;
      transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .count-btn:hover  { border-color: var(--accent2); color: var(--accent2); }
    .count-btn.selected { border-color: var(--accent2); background: rgba(0,229,160,0.1); color: var(--accent2); }

    .start-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      border: none;
      border-radius: 16px;
      color: white;
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 17px;
      font-weight: 900;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s;
      box-shadow: 0 8px 32px rgba(124,92,252,0.35);
      letter-spacing: 1px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .start-btn:active { transform: scale(0.97); }

    /* ===== GAME SCREEN ===== */
    .game-top { height: 16px; }

    .progress-bar-wrap { width: 100%; height: 5px; background: var(--border); border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 4px; transition: width 0.4s ease; }

    .score-row { display: flex; justify-content: space-between; width: 100%; margin-bottom: 16px; }
    .score-item { text-align: center; }
    .score-label { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
    .score-value { font-family: 'DM Mono', monospace; font-size: 20px; font-weight: 500; color: var(--text); margin-top: 2px; }

    /* „É©„Ç§„Éñ„Çø„Ç§„Éû„Éº */
    .live-timer-wrap {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 14px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 16px;
    }

    .live-timer-label { font-size: 11px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }

    .live-timer {
      font-family: 'DM Mono', monospace;
      font-size: 32px;
      font-weight: 500;
      color: var(--accent2);
      min-width: 85px;
      text-align: center;
      transition: color 0.3s;
    }

    .live-timer.warning { color: var(--wrong); }

    .question-area {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 28px 16px;
      text-align: center;
      margin-bottom: 14px;
      position: relative;
      overflow: hidden;
    }

    .question-area::before {
      content: '√ó';
      position: absolute;
      top: -20px; right: -10px;
      font-size: 180px;
      color: rgba(124,92,252,0.04);
      font-weight: 900;
      line-height: 1;
      pointer-events: none;
    }

    .question-tag { font-size: 10px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 12px; }

    .question-text {
      font-family: 'DM Mono', monospace;
      font-size: clamp(2rem, 9vw, 3.5rem);
      font-weight: 500;
      color: var(--text);
      letter-spacing: 2px;
      word-break: break-all;
    }

    .question-text .op { color: var(--accent); }

    /* „Çπ„Éû„ÉõÁî®„ÉÜ„É≥„Ç≠„ÉºÂÖ•Âäõ„Ç®„É™„Ç¢ */
    .answer-display {
      width: 100%;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      font-family: 'DM Mono', monospace;
      font-size: 28px;
      font-weight: 500;
      text-align: center;
      color: var(--text);
      min-height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      transition: border-color 0.2s, background 0.2s;
      letter-spacing: 2px;
    }

    .answer-display.placeholder { color: var(--border); font-size: 18px; letter-spacing: 0; }
    .answer-display.correct { border-color: var(--correct); background: rgba(0,229,160,0.07); }
    .answer-display.wrong   { border-color: var(--wrong);   background: rgba(255,82,119,0.07); animation: shake 0.3s; }
    .answer-display:focus   { border-color: var(--accent); outline: none; }

    /* Èö†„Åó inputÔºàPCÁî®Ôºâ */
    .hidden-input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      width: 1px; height: 1px;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-8px); }
      75% { transform: translateX(8px); }
    }

    .feedback {
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      padding: 6px;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .feedback.correct-msg { color: var(--correct); }
    .feedback.wrong-msg   { color: var(--wrong); }

    .time-badge {
      font-family: 'DM Mono', monospace;
      font-size: 12px;
      background: rgba(124,92,252,0.15);
      border: 1px solid var(--accent);
      color: var(--accent);
      border-radius: 8px;
      padding: 2px 9px;
    }

    /* ===== „ÉÜ„É≥„Ç≠„Éº ===== */
    .numpad {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 10px;
    }

    .numpad-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 0;
      height: 60px;
      color: var(--text);
      font-family: 'DM Mono', monospace;
      font-size: 22px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.12s, border-color 0.12s;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
    }

    .numpad-btn:active { background: rgba(124,92,252,0.2); border-color: var(--accent); }

    .numpad-btn.zero  { grid-column: span 1; }
    .numpad-btn.del   { background: rgba(255,82,119,0.08); border-color: rgba(255,82,119,0.3); color: var(--wrong); font-size: 18px; }
    .numpad-btn.del:active { background: rgba(255,82,119,0.2); }

    .submit-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      border: none;
      border-radius: 14px;
      color: white;
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 16px;
      font-weight: 900;
      cursor: pointer;
      transition: transform 0.1s;
      box-shadow: 0 6px 24px rgba(124,92,252,0.3);
      letter-spacing: 1px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .submit-btn:active { transform: scale(0.97); }

    /* ===== RESULT SCREEN ===== */
    .result-top { height: 20px; }

    .result-icon { font-size: 56px; margin-bottom: 12px; animation: pop 0.4s cubic-bezier(0.34,1.56,0.64,1); }

    @keyframes pop {
      from { transform: scale(0); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    .result-title   { font-size: 26px; font-weight: 900; margin-bottom: 4px; }
    .result-comment { color: var(--muted); font-size: 13px; margin-bottom: 20px; }

    .summary-grid { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }

    .summary-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      text-align: center;
    }

    .summary-card.accent { border-color: var(--accent); background: rgba(124,92,252,0.1); }
    .summary-card.fast   { border-color: var(--correct); background: rgba(0,229,160,0.07); }
    .summary-card .s-label { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 5px; }
    .summary-card .s-value { font-family: 'DM Mono', monospace; font-size: 22px; font-weight: 500; }
    .summary-card.accent .s-value { color: var(--accent); }
    .summary-card.fast   .s-value { color: var(--correct); }

    .detail-title { font-size: 11px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px; align-self: flex-start; }

    .time-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-bottom: 20px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
      -webkit-overflow-scrolling: touch;
    }

    .time-list::-webkit-scrollbar { width: 4px; }
    .time-list::-webkit-scrollbar-track { background: var(--border); border-radius: 4px; }
    .time-list::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }

    .time-row {
      display: flex;
      align-items: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 11px 14px;
      gap: 8px;
    }

    .time-row.best  { border-color: var(--correct); }
    .time-row.worst { border-color: var(--wrong); }

    .time-row .q-num  { font-size: 10px; color: var(--muted); min-width: 22px; }
    .time-row .q-expr { font-family: 'DM Mono', monospace; font-size: 12px; flex: 1; word-break: break-all; }
    .time-row .q-result { font-size: 12px; font-weight: 700; }
    .time-row .q-result.ok { color: var(--correct); }
    .time-row .q-result.ng { color: var(--wrong); }
    .time-row .q-time { font-family: 'DM Mono', monospace; font-size: 14px; font-weight: 500; min-width: 54px; text-align: right; }
    .time-row.best  .q-time { color: var(--correct); }
    .time-row.worst .q-time { color: var(--wrong); }

    .badge-tag { font-size: 9px; padding: 2px 6px; border-radius: 6px; font-weight: 700; white-space: nowrap; }
    .badge-tag.best  { background: rgba(0,229,160,0.15); color: var(--correct); }
    .badge-tag.worst { background: rgba(255,82,119,0.15); color: var(--wrong); }

    .retry-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, var(--accent), #a78bfa);
      border: none;
      border-radius: 16px;
      color: white;
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 16px;
      font-weight: 900;
      cursor: pointer;
      box-shadow: 0 8px 32px rgba(124,92,252,0.35);
      margin-bottom: 10px;
      letter-spacing: 1px;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .retry-btn:active { transform: scale(0.97); }

    .home-btn {
      width: 100%;
      padding: 16px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 16px;
      color: var(--muted);
      font-family: 'Noto Sans JP', sans-serif;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .home-btn:active { border-color: var(--text); color: var(--text); }

    /* PC „Åß„ÅØ inputË°®Á§∫„Éª„ÉÜ„É≥„Ç≠„ÉºÈùûË°®Á§∫ */
    @media (hover: hover) and (pointer: fine) {
      .numpad { display: none; }
      .answer-display { display: none; }
      .pc-input-wrap { display: block; }
    }

    .pc-input-wrap { display: none; }

    .answer-input-pc {
      width: 100%;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 18px 20px;
      color: var(--text);
      font-family: 'DM Mono', monospace;
      font-size: 26px;
      font-weight: 500;
      text-align: center;
      outline: none;
      transition: border-color 0.2s;
      margin-bottom: 10px;
    }

    .answer-input-pc::placeholder { color: var(--border); }
    .answer-input-pc:focus   { border-color: var(--accent); }
    .answer-input-pc.correct { border-color: var(--correct); background: rgba(0,229,160,0.07); }
    .answer-input-pc.wrong   { border-color: var(--wrong);   background: rgba(255,82,119,0.07); animation: shake 0.3s; }
  </style>
</head>
<body>

  <!-- ===== START SCREEN ===== -->
  <div class="screen active" id="startScreen">
    <div class="top-space"></div>
    <div class="title-badge">ÊöóÁÆó„Éà„É¨„Éº„Éã„É≥„Ç∞</div>
    <h1>È†≠„Çí<span>Èçõ„Åà„Çà„ÅÜ</span></h1>
    <p class="subtitle">Êéõ„ÅëÁÆó ‚Äî Ê°ÅÊï∞„ÇíËá™Áî±„Å´ÈÅ∏„Çì„ÅßÊåëÊà¶ÔºÅ</p>

    <!-- Ê°ÅÊï∞„Çª„É¨„ÇØ„Çø„Éº -->
    <div class="card">
      <div class="card-title">üî¢ Ê°ÅÊï∞„ÇíÈÅ∏„Å∂</div>
      <div class="digits-row">
        <div class="digits-group">
          <div class="digits-label">Â∑¶„ÅÆÊï∞ÔºàAÔºâ</div>
          <div class="digits-btns" id="digitsA">
            <button class="digit-btn" data-side="A" data-d="1" onclick="selectDigit('A',1)">1Ê°Å</button>
            <button class="digit-btn selected" data-side="A" data-d="2" onclick="selectDigit('A',2)">2Ê°Å</button>
            <button class="digit-btn" data-side="A" data-d="3" onclick="selectDigit('A',3)">3Ê°Å</button>
          </div>
        </div>
        <div class="digits-op">√ó</div>
        <div class="digits-group">
          <div class="digits-label">Âè≥„ÅÆÊï∞ÔºàBÔºâ</div>
          <div class="digits-btns" id="digitsB">
            <button class="digit-btn selected" data-side="B" data-d="1" onclick="selectDigit('B',1)">1Ê°Å</button>
            <button class="digit-btn" data-side="B" data-d="2" onclick="selectDigit('B',2)">2Ê°Å</button>
            <button class="digit-btn" data-side="B" data-d="3" onclick="selectDigit('B',3)">3Ê°Å</button>
          </div>
        </div>
      </div>
      <div class="preview-expr" id="previewExpr">‰æã: <span>25 √ó 7</span></div>
    </div>

    <!-- ÂïèÈ°åÊï∞ -->
    <div class="card">
      <div class="card-title">üìù ÂïèÈ°åÊï∞</div>
      <div class="count-grid">
        <button class="count-btn" data-count="5"  onclick="selectCount(5)">5Âïè</button>
        <button class="count-btn selected" data-count="10" onclick="selectCount(10)">10Âïè</button>
        <button class="count-btn" data-count="20" onclick="selectCount(20)">20Âïè</button>
      </div>
    </div>

    <button class="start-btn" onclick="startGame()">„Çπ„Çø„Éº„Éà ‚Üí</button>
  </div>

  <!-- ===== GAME SCREEN ===== -->
  <div class="screen" id="gameScreen">
    <div class="game-top"></div>
    <div class="progress-bar-wrap" style="width:100%">
      <div class="progress-bar" id="progressBar" style="width:0%"></div>
    </div>

    <div class="score-row">
      <div class="score-item">
        <div class="score-label">ÂïèÈ°å</div>
        <div class="score-value" id="questionCount">1 / 10</div>
      </div>
      <div class="score-item">
        <div class="score-label">Ê≠£Ëß£</div>
        <div class="score-value" id="correctCount">0</div>
      </div>
      <div class="score-item">
        <div class="score-label">„Éü„Çπ</div>
        <div class="score-value" id="wrongCount">0</div>
      </div>
    </div>

    <div class="live-timer-wrap">
      <span class="live-timer-label">‚è± „Åì„ÅÆÂïèÈ°å</span>
      <span class="live-timer" id="liveTimer">0.00</span>
      <span class="live-timer-label">Áßí</span>
    </div>

    <div class="question-area">
      <div class="question-tag">Á≠î„Åà„ÅØÔºü</div>
      <div class="question-text">
        <span id="numA">25</span>
        <span class="op"> √ó </span>
        <span id="numB">7</span>
        <span class="op"> = ?</span>
      </div>
    </div>

    <!-- „Çπ„Éû„Éõ: „Çø„ÉÉ„ÉóÂÖ•ÂäõË°®Á§∫ -->
    <div class="answer-display placeholder" id="answerDisplay">Á≠î„Åà„ÇíÂÖ•Âäõ</div>

    <!-- PC: „ÉÜ„Ç≠„Çπ„Éà input -->
    <div class="pc-input-wrap">
      <input type="number" class="answer-input-pc" id="answerInputPc"
        placeholder="Á≠î„Åà„ÇíÂÖ•Âäõ" autocomplete="off" inputmode="numeric" />
    </div>

    <div class="feedback" id="feedback"></div>

    <!-- „Çπ„Éû„Éõ: „ÉÜ„É≥„Ç≠„Éº -->
    <div class="numpad" id="numpad">
      <button class="numpad-btn" onclick="numpadPress('7')">7</button>
      <button class="numpad-btn" onclick="numpadPress('8')">8</button>
      <button class="numpad-btn" onclick="numpadPress('9')">9</button>
      <button class="numpad-btn" onclick="numpadPress('4')">4</button>
      <button class="numpad-btn" onclick="numpadPress('5')">5</button>
      <button class="numpad-btn" onclick="numpadPress('6')">6</button>
      <button class="numpad-btn" onclick="numpadPress('1')">1</button>
      <button class="numpad-btn" onclick="numpadPress('2')">2</button>
      <button class="numpad-btn" onclick="numpadPress('3')">3</button>
      <button class="numpad-btn zero" onclick="numpadPress('0')">0</button>
      <button class="numpad-btn del" onclick="numpadPress('del')">‚å´</button>
      <button class="numpad-btn" onclick="checkAnswer()" style="background:rgba(124,92,252,0.15);border-color:var(--accent);color:var(--accent);font-size:14px;">OK</button>
    </div>

    <button class="submit-btn" id="submitBtn" onclick="checkAnswer()">Á≠î„Åà„Çã</button>
  </div>

  <!-- ===== RESULT SCREEN ===== -->
  <div class="screen" id="resultScreen">
    <div class="result-top"></div>
    <div class="result-icon" id="resultIcon">üèÜ</div>
    <div class="result-title" id="resultTitle">„ÅäÁñ≤„Çå„Åï„ÅæÔºÅ</div>
    <div class="result-comment" id="resultComment">ÂÖ®Âïè„ÉÅ„É£„É¨„É≥„Ç∏ÂÆå‰∫ÜÔºÅ</div>

    <div class="summary-grid" id="summaryGrid"></div>

    <div class="detail-title">üìã ÂïèÈ°å„Åî„Å®„ÅÆ„Çø„Ç§„É†</div>
    <div class="time-list" id="timeList"></div>

    <button class="retry-btn" onclick="retryGame()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÇÑ„Çã üîÑ</button>
    <button class="home-btn" onclick="goHome()">‚Üê „Éõ„Éº„É†„Å´Êàª„Çã</button>
  </div>

<script>
  // ===== STATE =====
  let digitsA = 2, digitsB = 1;
  let selectedCount = 10;
  let currentQ = 0, correctNum = 0, wrongNum = 0;
  let currentAnswer = 0, totalQuestions = 10;
  let answered = false, currentExpr = '';
  let questionStartTime = 0, timerInterval = null;
  let questionLog = [];
  let numpadValue = '';
  let isSmartphone = false;

  // „Éá„Éê„Ç§„ÇπÂà§ÂÆöÔºà„Çø„ÉÉ„ÉÅ„ÅÆ„Åø„ÅÆÁ´ØÊú´„Çí„Çπ„Éû„Éõ„Å®Âà§ÂÆöÔºâ
  function detectDevice() {
    isSmartphone = !window.matchMedia('(hover: hover) and (pointer: fine)').matches;
  }

  // ===== SELECTORS =====
  function selectDigit(side, d) {
    if (side === 'A') digitsA = d;
    else              digitsB = d;
    document.querySelectorAll(`#digits${side} .digit-btn`).forEach(b => b.classList.remove('selected'));
    document.querySelector(`#digits${side} .digit-btn[data-d="${d}"]`).classList.add('selected');
    updatePreview();
  }

  function updatePreview() {
    const aMin = Math.pow(10, digitsA - 1), aMax = Math.pow(10, digitsA) - 1;
    const bMin = Math.pow(10, digitsB - 1), bMax = Math.pow(10, digitsB) - 1;
    const a = randInt(aMin, Math.min(aMax, aMin + 9));
    const b = randInt(bMin, Math.min(bMax, bMin + 9));
    document.getElementById('previewExpr').innerHTML = `‰æã: <span>${a} √ó ${b}</span>`;
  }

  function selectCount(n) {
    selectedCount = n;
    document.querySelectorAll('.count-btn').forEach(b => b.classList.remove('selected'));
    document.querySelector(`.count-btn[data-count="${n}"]`).classList.add('selected');
  }

  // ===== UTILS =====
  function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function generateQuestion() {
    const aMin = Math.pow(10, digitsA - 1), aMax = Math.pow(10, digitsA) - 1;
    const bMin = Math.pow(10, digitsB - 1), bMax = Math.pow(10, digitsB) - 1;
    const a = randInt(aMin, aMax);
    const b = randInt(bMin, bMax);
    currentAnswer = a * b;
    document.getElementById('numA').textContent = a;
    document.getElementById('numB').textContent = b;
    return `${a} √ó ${b}`;
  }

  function startTimer() {
    questionStartTime = performance.now();
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      const elapsed = (performance.now() - questionStartTime) / 1000;
      const el = document.getElementById('liveTimer');
      el.textContent = elapsed.toFixed(2);
      el.classList.toggle('warning', elapsed >= 10);
    }, 50);
  }

  function stopTimer() {
    clearInterval(timerInterval);
    return (performance.now() - questionStartTime) / 1000;
  }

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0, 0);
  }

  // ===== „ÉÜ„É≥„Ç≠„Éº =====
  function numpadPress(key) {
    if (answered) return;
    if (key === 'del') {
      numpadValue = numpadValue.slice(0, -1);
    } else {
      if (numpadValue.length >= 7) return;
      numpadValue += key;
    }
    const display = document.getElementById('answerDisplay');
    if (numpadValue === '') {
      display.textContent = 'Á≠î„Åà„ÇíÂÖ•Âäõ';
      display.className = 'answer-display placeholder';
    } else {
      display.textContent = numpadValue;
      display.className = 'answer-display';
    }
  }

  function getCurrentValue() {
    if (isSmartphone) {
      return numpadValue === '' ? NaN : parseInt(numpadValue, 10);
    } else {
      const v = document.getElementById('answerInputPc').value.trim();
      return v === '' ? NaN : parseInt(v, 10);
    }
  }

  // ===== GAME FLOW =====
  function startGame() {
    detectDevice();
    currentQ = 0; correctNum = 0; wrongNum = 0;
    totalQuestions = selectedCount;
    answered = false;
    questionLog = [];
    showScreen('gameScreen');
    loadQuestion();
  }

  function loadQuestion() {
    answered = false;
    numpadValue = '';
    currentQ++;

    // „ÉÜ„É≥„Ç≠„ÉºË°®Á§∫„É™„Çª„ÉÉ„Éà
    const display = document.getElementById('answerDisplay');
    display.textContent = 'Á≠î„Åà„ÇíÂÖ•Âäõ';
    display.className = 'answer-display placeholder';

    // PC input „É™„Çª„ÉÉ„Éà
    const pcInput = document.getElementById('answerInputPc');
    pcInput.value = '';
    pcInput.className = 'answer-input-pc';
    pcInput.disabled = false;

    // numpad „É™„Çª„ÉÉ„ÉàË¶ã„ÅüÁõÆ
    const numpad = document.getElementById('numpad');
    numpad.querySelectorAll('.numpad-btn').forEach(b => b.disabled = false);

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.textContent = 'Á≠î„Åà„Çã';
    submitBtn.disabled = false;

    document.getElementById('feedback').textContent = '';
    document.getElementById('feedback').className = 'feedback';
    document.getElementById('questionCount').textContent = `${currentQ} / ${totalQuestions}`;
    document.getElementById('correctCount').textContent = correctNum;
    document.getElementById('wrongCount').textContent = wrongNum;

    const pct = ((currentQ - 1) / totalQuestions) * 100;
    document.getElementById('progressBar').style.width = pct + '%';

    const timer = document.getElementById('liveTimer');
    timer.textContent = '0.00';
    timer.classList.remove('warning');

    if (!isSmartphone) {
      setTimeout(() => document.getElementById('answerInputPc').focus(), 50);
    }

    currentExpr = generateQuestion();
    startTimer();
  }

  function checkAnswer() {
    if (answered) { nextOrFinish(); return; }

    const val = getCurrentValue();

    if (isNaN(val)) {
      // ÂÖ•Âäõ„Å™„ÅóË≠¶Âëä
      const display = document.getElementById('answerDisplay');
      const pcInput = document.getElementById('answerInputPc');
      if (isSmartphone) {
        display.style.borderColor = 'var(--wrong)';
        setTimeout(() => display.style.borderColor = '', 500);
      } else {
        pcInput.style.borderColor = 'var(--wrong)';
        setTimeout(() => pcInput.style.borderColor = '', 500);
        pcInput.focus();
      }
      return;
    }

    const elapsed = stopTimer();
    answered = true;

    const isCorrect = val === currentAnswer;
    const feedback  = document.getElementById('feedback');
    const submitBtn = document.getElementById('submitBtn');
    const display   = document.getElementById('answerDisplay');
    const pcInput   = document.getElementById('answerInputPc');

    questionLog.push({ q: currentQ, expr: currentExpr, answer: currentAnswer, userAnswer: val, correct: isCorrect, time: elapsed });

    if (isCorrect) {
      correctNum++;
      display.classList.add('correct');
      pcInput.classList.add('correct');
      feedback.innerHTML = `‚úì Ê≠£Ëß£ÔºÅ <span class="time-badge">‚è± ${elapsed.toFixed(2)}Áßí</span>`;
      feedback.className = 'feedback correct-msg';
    } else {
      wrongNum++;
      display.classList.add('wrong');
      pcInput.classList.add('wrong');
      feedback.innerHTML = `‚úó ‰∏çÊ≠£Ëß£‚Ä¶ Á≠î„Åà„ÅØ ${currentAnswer} <span class="time-badge">‚è± ${elapsed.toFixed(2)}Áßí</span>`;
      feedback.className = 'feedback wrong-msg';
    }

    // „ÉÜ„É≥„Ç≠„ÉºÁÑ°ÂäπÂåñ
    document.querySelectorAll('.numpad-btn').forEach(b => b.disabled = true);
    pcInput.disabled = true;

    document.getElementById('correctCount').textContent = correctNum;
    document.getElementById('wrongCount').textContent   = wrongNum;
    submitBtn.textContent = currentQ >= totalQuestions ? 'ÁµêÊûú„ÇíË¶ã„Çã ‚Üí' : 'Ê¨°„ÅÆÂïèÈ°å ‚Üí';
    submitBtn.disabled = false;
  }

  function nextOrFinish() {
    if (currentQ >= totalQuestions) showResult();
    else loadQuestion();
  }

  function showResult() {
    document.getElementById('progressBar').style.width = '100%';

    const times    = questionLog.map(l => l.time);
    const total    = times.reduce((a, b) => a + b, 0);
    const avg      = total / times.length;
    const minTime  = Math.min(...times);
    const maxTime  = Math.max(...times);

    let icon, title, comment;
    if      (avg < 3)  { icon='‚ö°'; title='ÁàÜÈÄüÔºÅ';    comment='Âπ≥Âùá3ÁßíÊú™Ê∫ÄÔºÅÈ©öÁï∞ÁöÑ„Å™ÈÄü„ÅïÔºÅ'; }
    else if (avg < 6)  { icon='üèÜ'; title='„Åô„Åî„ÅÑÔºÅ';  comment='Âπ≥Âùá6ÁßíÊú™Ê∫ÄÔºÅ„Åã„Å™„ÇäÈÄü„ÅÑÔºÅ'; }
    else if (avg < 10) { icon='üéâ'; title='„Ç∞„ÉÉ„ÉâÔºÅ';  comment='ËâØ„ÅÑ„Éö„Éº„ÇπÔºÅ„Åï„Çâ„Å´ÈÄü„Åè„Å™„Çå„ÇãÔºÅ'; }
    else               { icon='üí™'; title='„Éï„Ç°„Ç§„ÉàÔºÅ'; comment='Á∑¥Áøí„ÇíÈáç„Å≠„Å¶„Çø„Ç§„É†„ÇíÁ∏Æ„ÇÅ„Çà„ÅÜÔºÅ'; }

    document.getElementById('resultIcon').textContent    = icon;
    document.getElementById('resultTitle').textContent   = title;
    document.getElementById('resultComment').textContent = comment;

    document.getElementById('summaryGrid').innerHTML = `
      <div class="summary-card accent">
        <div class="s-label">ÂêàË®à„Çø„Ç§„É†</div>
        <div class="s-value">${total.toFixed(2)}s</div>
      </div>
      <div class="summary-card">
        <div class="s-label">Âπ≥Âùá„Çø„Ç§„É†</div>
        <div class="s-value">${avg.toFixed(2)}s</div>
      </div>
      <div class="summary-card fast">
        <div class="s-label">üèÉ ÊúÄÈÄü</div>
        <div class="s-value">${minTime.toFixed(2)}s</div>
      </div>
      <div class="summary-card">
        <div class="s-label">üê¢ ÊúÄÈÅÖ</div>
        <div class="s-value">${maxTime.toFixed(2)}s</div>
      </div>
    `;

    const listHTML = questionLog.map(log => {
      const isBest  = Math.abs(log.time - minTime) < 0.001;
      const isWorst = Math.abs(log.time - maxTime) < 0.001 && questionLog.length > 1;
      const rowClass  = isBest ? 'best' : isWorst ? 'worst' : '';
      const badge     = isBest  ? '<span class="badge-tag best">ÊúÄÈÄü</span>'
                      : isWorst ? '<span class="badge-tag worst">ÊúÄÈÅÖ</span>' : '';
      const resultCls = log.correct ? 'ok' : 'ng';
      const resultTxt = log.correct ? '‚úì' : `‚úó(${log.answer})`;
      return `
        <div class="time-row ${rowClass}">
          <span class="q-num">Q${log.q}</span>
          <span class="q-expr">${log.expr} = ${log.correct ? log.answer : `<s>${log.userAnswer}</s>`}</span>
          <span class="q-result ${resultCls}">${resultTxt}</span>
          ${badge}
          <span class="q-time">${log.time.toFixed(2)}s</span>
        </div>`;
    }).join('');

    document.getElementById('timeList').innerHTML = listHTML;
    showScreen('resultScreen');
  }

  function retryGame() { startGame(); }
  function goHome() { clearInterval(timerInterval); showScreen('startScreen'); }

  // PC: Enter„Ç≠„Éº
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter' && document.getElementById('gameScreen').classList.contains('active')) {
      checkAnswer();
    }
  });

  // ÂàùÊúüÂåñ
  detectDevice();
  updatePreview();
</script>
</body>
</html>
